# === RubberBand/config.yaml ===

# ──────────────────────────────────────────────────────────────────────────────
# INTERVALS / PERIODS
# ──────────────────────────────────────────────────────────────────────────────
intervals: ["15m"]
periods:
  "15m": "10d"

# ──────────────────────────────────────────────────────────────────────────────
# SESSION / DATA
# ──────────────────────────────────────────────────────────────────────────────
timezone: "US/Eastern"
rth_only: true
rth_start: "09:30"
rth_end:   "15:55"

# Entry Windows (Eastern Time) - Avoid first 15m volatility
entry_windows:
  - start: "09:45"
    end: "15:45"

bar_limit: 10000
feed: "iex"

run:
  force_run: 0

# ──────────────────────────────────────────────────────────────────────────────
# INDICATORS
# ──────────────────────────────────────────────────────────────────────────────
keltner_length: 20
keltner_mult: 2.0
atr_length: 14
atr_length: 14
rsi_length: 14

# Slope Filter (Anti-Falling Knife)
slope_threshold: -0.20
# ──────────────────────────────────────────────────────────────────────────────
# RISK CONTROLS
# ──────────────────────────────────────────────────────────────────────────────
flatten_minutes_before_close: 15
entry_cutoff_min: 20

# RESILIENCE (Dynamic Circuit Breaker)
resilience:
  enabled: true
  lookback_trades: 5        # Check last 5 trades
  max_consecutive_losses: 3 # Pause if 3 losses in a row
  drawdown_threshold_usd: -100.0 # Pause if net loss < -$100 in lookback
  probation_period_days: 7  # How long to stay paused
  
trend_filter:
  enabled: true
  sma_period: 20   # Changed from 200 to 20 for 15M options (better trade opportunity)

# POSITION / SIZING
allow_shorts: false
qty: 10000
max_shares_per_trade: 10000
max_notional_per_trade: 2000
max_open_trades_per_ticker: 1

# ──────────────────────────────────────────────────────────────────────────────
# BRACKET ORDERS
# ──────────────────────────────────────────────────────────────────────────────
brackets:
  enabled: true
  atr_mult_sl: 2.5          # Stop Loss = 2.5 ATR (Option 2: Consistency)
  take_profit_r: 1.5        # Take Profit = 1.5 ATR (Option 2: Consistency)

# Breakeven (Optional)
breakeven:
  enabled: true
  trigger_r: 1.0            # Move to BE at 1.0 R
  bump_ticks: 2
  tick_size: 0.01

# ──────────────────────────────────────────────────────────────────────────────
# FILTERS / GATES
# ──────────────────────────────────────────────────────────────────────────────
filters:
  rsi_oversold: 25           # Buy when RSI < 25 (Option 2: Consistency)
  rsi_overbought: 70         # (Future use for shorts)
  min_price: 5.0
  min_dollar_vol: 1000000    # Adjusted for IEX feed volume
  trend_filter_sma: 0        # Disabled (Too restrictive)
  # Filter overrides to allow mean reversion (RSI < 25)
  rsi_min: 15
  rsi_max: 100
  adx_threshold: 0           # Disable ADX requirement for now
  slope_threshold_pct: -0.001 # Allow slight pullback slope
  require_fast_above_slow: false # Allow deep dips where fast EMA crosses slow

# ──────────────────────────────────────────────────────────────────────────────
# EXIT STRATEGY
# ──────────────────────────────────────────────────────────────────────────────
# NOTE: Live bot ONLY uses Brackets (TP/SL). 
# We disable these "smart exits" in backtest to match live reality.
exit_at_mean: false
exit_at_upper: false

# ──────────────────────────────────────────────────────────────────────────────
# OUTPUT
# ──────────────────────────────────────────────────────────────────────────────
results_dir: "results"

# ──────────────────────────────────────────────────────────────────────────────
# BROKER
# ──────────────────────────────────────────────────────────────────────────────
broker:
  base_url: "https://paper-api.alpaca.markets"
  key: ""
  secret: ""
