name: Daily Strong Bull Ticker Scan

on:
  schedule:
    # Run at 00:00 UTC every day
    - cron: '0 0 * * *'
  workflow_dispatch:
    # Allow manual trigger

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f RubberBand/requirements.txt ]; then pip install -r RubberBand/requirements.txt; fi
          # Ensure pandas and requests are installed if not in requirements
          pip install pandas requests pyyaml numpy

      - name: Run Ticker Scan
        env:
          # Use secrets for Alpaca keys if needed for data fetching
          # Note: IEX feed might not need keys for some endpoints, but better to have them
          ALPACA_KEY_ID: ${{ secrets.ALPACA_KEY_ID }}
          ALPACA_SECRET_KEY: ${{ secrets.ALPACA_SECRET_KEY }}
          APCA_API_BASE_URL: https://paper-api.alpaca.markets
        run: |
          # Run the scan script
          # Note: Using full list might take time. Adjust limit if needed for CI timeout.
          # For now, we run full list.
          python RubberBand/scripts/scan_strong_bull_candidates.py --tickers tickers_full_list.txt --output candidates.csv

      - name: Upload Candidates Artifact
        uses: actions/upload-artifact@v4
        with:
          name: candidates-csv
          path: candidates.csv
